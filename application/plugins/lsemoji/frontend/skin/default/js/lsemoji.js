$(document).ready(function(){$.getJSON(PATH_ROOT+'/lsemoji/list/',{security_ls_key:LIVESTREET_SECURITY_KEY},function(a,c){if(a){e(a.aSmiles)}});function e(d){selector='.ls-text, .ls-comment-text';$(selector).each(function(f){sText=$(this).html();if(sText!=null){$(this).html(sText.replace(/([:;A-Z0-9%]*[_]?[\/\\a-zA-Z-\)\(\*]*)+/g,function(a,c){if(d[c]!=undefined){return"<span class='smile' style='background-position:"+d[c]+"'></span>"}else{return a}}))}})}ls.hook.add('ls_comments_add_after',function(){$.getJSON(PATH_ROOT+'/lsemoji/list/',{security_ls_key:LIVESTREET_SECURITY_KEY},function(a,c){if(a){e(a.aSmiles)}})})});(function(b){var i;var g={init:function(a){g.initMarkitup.apply(this,arguments)},initMarkitup:function(c){c.markupSet.push({separator:'-'});c.markupSet.push({name:"Смайлики",className:"bsEditor",beforeInsert:function(a){b(a.textarea).lsemoji('toggle')}})},toggle:function(){return this.each(function(){var a=g.getList.apply(this);a.toggleClass('smilesHide')})},getList:function(){var f=b(this);var d=f.attr('id');var e='bsAllList_'+d;var h=b('#bsAllList_'+d);if(h.size()){return h}h=b('<div class="bsAllList smilesHide"/>').attr('id',e).insertBefore(f);var j=b('<div class="lsEmoji"></div>').width('auto').insertBefore(f);if(!i){b.getJSON(PATH_ROOT+'/lsemoji/list/',{security_ls_key:LIVESTREET_SECURITY_KEY},function(a,c){if(a){i=a.aSmiles;g.insertSmiles.apply(f,[h])}})}return h.appendTo(j)},insertSmiles:function(e){var h=b(this);e.empty();b.each(i,function(a,c){var f=b("<span class='smile' style='background-position:"+c+"'></span>");var d=b("<a href='#'></a>").attr('title',a).data({'bsSmile':a,'bsArea':h.attr('id')});d.click(function(){b.markItUp({replaceWith:b(this).data('bsSmile')+' ',target:'#'+b(this).data('bsArea')});return false});d.append(f);e.append(d)})}};b.fn.lsemoji=function(a){if(a==='methods'){return g}else if(g[a]){return g[a].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof a==='object'||!a){return g.init.apply(this,arguments)}};b.bsStart=function(){if(typeof b.fn.markItUp=='function'){ls.hook.inject([jQuery.fn,'markItUp'],function(a,c){this.lsemoji('methods').initMarkitup(a||{markupSet:[]})})}}})(jQuery);$(function(a){a.bsStart()});